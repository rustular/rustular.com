---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../../components/Layout.astro';
import { Image } from 'astro:assets';

import type { GetStaticPaths, InferGetStaticParamsType } from 'astro';

export const getStaticPaths = (async () => {
  const newsletterEntries = await getCollection('newsletter');
  return newsletterEntries.map((entry) => ({
    params: { slug: entry.slug },
  }));
}) satisfies GetStaticPaths;

const { slug } = Astro.params as InferGetStaticParamsType<
  typeof getStaticPaths
>;
const entry = await getEntry('newsletter', slug);
const { Content, headings } = await entry.render();
---

<Layout title={entry.data.title}>
  <div class="mx-auto max-w-2xl">
    <div class="pb-8">
      <h1 class="text-2xl font-bold">{entry.data.title}</h1>
      <p class="text-gray-500">{entry.data.date}</p>
      <Image
        class="my-4 w-full rounded-lg"
        src={entry.data.cover}
        alt={entry.data.title}
      />
      <p>{entry.data.description}</p>
      <div>
        <h2 class="text-lg font-semibold">Table of Contents</h2>
        <ol class="list-decimal pl-8">
          {
            headings
              .filter((heading) => heading.depth === 1)
              .map((heading) => (
                <li>
                  <a
                    href={`#${heading.slug}`}
                    class="text-blue-500 hover:underline"
                  >
                    {heading.text}
                  </a>
                </li>
              ))
          }
        </ol>
      </div>
    </div>
    <article class="prose-thin prose prose-invert">
      <Content />
    </article>
  </div>
</Layout>
